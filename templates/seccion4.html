{% extends "base.html" %}

{% block title %}Sección 4 - ConoceMed{% endblock %}

{% block content %}


<section class="vista" id="seccion4">
  <div class="declarar-contenedor">

    <!-- Animación o imagen a la izquierda -->
    <div class="declarar-animacion" id="muneco">

    </div>

    <!-- Formulario a la derecha -->
    <div class="declarar-formulario">
      <h2>DECLARA UN LUGAR</h2>
      <p>Aquí puedes recomendar un lugar que debería estar en la app.</p>

      <form id="formSugerirLugar" method="POST" enctype="multipart/form-data">
        {{ form.hidden_tag() }}

        {{ form.nombre.label }}
        {{ form.nombre(class="form-control", placeholder="Nombre del lugar *") }}

        {{ form.direccion.label }}
        {{ form.direccion(class="form-control", placeholder="Dirección *") }}

        {{ form.latitud.label }}
        {{ form.latitud(class="form-control", placeholder="Latitud *") }}

        {{ form.longitud.label }}
        {{ form.longitud(class="form-control", placeholder="Longitud *") }}

        {{ form.descripcion.label }}
        {{ form.descripcion(class="form-control", placeholder="Descripción *", rows="4") }}

        {{ form.horario_apertura.label }}
        {{ form.horario_apertura(class="form-control", placeholder="Horario de apertura *") }}

        {{ form.horario_cierre.label }}
        {{ form.horario_cierre(class="form-control", placeholder="Horario de cierre *") }}

        {{ form.tarifa.label }}
        {{ form.tarifa(class="form-control", placeholder="Tarifa *") }}

        {{ form.idLocalidad.label }}
        {{ form.idLocalidad(class="form-control") }}

        {{ form.idCategoria_Turistica.label }}
        {{ form.idCategoria_Turistica(class="form-control") }}

        <!-- Campo de archivos -->
        <label for="archivos">Sube imágenes o videos del lugar:</label>
        <input type="file" name="archivos" id="archivos" class="form-control" multiple accept="image/*,video/*">

        {{ form.submit(class="btn btn-primary", value="Enviar sugerencia") }}
      </form>

      <!-- Contenedor de mensajes -->
      <div id="mensaje-resultado" class="mensaje"></div>

    </div>

  </div>


{% endblock %}

{% block scripts %}
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const container = document.getElementById("muneco");

      if (!container) {
        console.error("❌ No se encontró el contenedor #muneco");
        return;
      }

      const muneco = lottie.loadAnimation({
        container: container,
        renderer: "svg",
        loop: true,
        autoplay: true,
        path: "{{ url_for('static', filename='images/paisa.json') }}"
      });

      muneco.addEventListener("DOMLoaded", () => {
        console.log("✅ Animación cargada completamente");
      });
    });
  </script>

  <!-- Script para enviar el formulario sin recargar -->
  <script>
    document.getElementById("formSugerirLugar").addEventListener("submit", async function (e) {
      e.preventDefault();

      const formData = new FormData(this);

      const response = await fetch("{{ url_for('vistaSugerido.sugerir_lugar') }}", {
        method: "POST",
        body: formData
      });

      const data = await response.json();

      const mensaje = document.getElementById("mensaje-resultado");
      if (data.success) {
        mensaje.textContent = "✅ Lugar enviado con éxito. ¡Gracias por tu aporte!";
        mensaje.style.color = "green";
        this.reset();
      } else {
        mensaje.textContent = "❌ Error al enviar. Revisa los campos.";
        mensaje.style.color = "red";
      }
    });
  </script>
  {% endblock %}