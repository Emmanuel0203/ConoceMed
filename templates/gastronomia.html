{% extends "base.html" %}

{% block title %}Gastronomía{% endblock %}

{% block head %}
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />

  <!-- Estilos personalizados -->
  <style>
    html {
      scroll-behavior: smooth; /* Scroll suave */
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #cfd8d8;
      overflow-x: hidden;
    }

    .contenido-principal {
      padding: 2rem;
      background-color: #cfd8d8;
      min-height: 100vh;
    }

    h1 {
      color: #154360;
      padding-top: 1rem;
    }

    a button,
    button {
      background-color: #154360;
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: 5px;
      cursor: pointer;
      margin-top: 20px;
      font-size: 1rem;
    }

    a button:hover,
    button:hover {
      background-color: #0b2e4a;
    }

    #map {
      margin-top: 1.5rem;
      height: 400px;
      width: 100%;
      border-radius: 10px;
      border: 2px solid #154360;
    }
  </style>
{% endblock %}

{% block content %}
  <div class="contenido-principal">
    <h1>Gastronomía</h1>
    <p>
      Disfruta de la variada oferta gastronómica de Medellín, con sabores tradicionales y experiencias culinarias únicas.
    </p>

    <!-- Mapa interactivo -->
    <div id="map"></div>

    <!-- Botón de volver a la sección 2 -->
    <div style="margin-top: 20px;">
      <a href="{{ url_for('index') }}#seccion2">
        <button>Volver</button>
      </a>
    </div>
  </div>
{% endblock %}

{% block scripts %}
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>

  <script>
    // Inicializar el mapa centrado en Medellín
    const mapa = L.map('map').setView([6.2518, -75.5636], 13);

    // Capa base
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(mapa);

    // UUID de la categoría "Gastronomía"
    const CATEGORIA_GASTRONOMIA_UUID = "14e9001d-45f5-4d4d-93fa-9de642d10eec";

    // Obtener sitios desde la API
    fetch("http://localhost:5031/api/sitio_turistico")
      .then((res) => res.json())
      .then((data) => {
        console.log("✅ Datos recibidos de la API:", data);

        if (!data.datos || !Array.isArray(data.datos)) {
          console.warn("⚠️ La API no devolvió una lista de sitios válida.");
          return;
        }

        const sitiosFiltrados = data.datos.filter(
          (sitio) => sitio.fkidCategoria_Turistica === CATEGORIA_GASTRONOMIA_UUID
        );

        if (sitiosFiltrados.length === 0) {
          alert("⚠️ No hay sitios para la categoría 'Gastronomía'.");
          return;
        }

        // Agregar marcadores al mapa
        sitiosFiltrados.forEach((sitio) => {
          if (!sitio.latitud || !sitio.longitud) return;

          const marker = L.marker([sitio.latitud, sitio.longitud]).addTo(mapa);
          marker.bindPopup(`
            <strong>${sitio.nombre}</strong><br>
            ${sitio.descripcion}<br>
            <b>Dirección:</b> ${sitio.direccion}<br>
            <b>Horario:</b> ${sitio.horario_apertura} - ${sitio.horario_cierre}<br>
            <b>Tarifa:</b> $${sitio.tarifa}
          `);
        });
      })
      .catch((err) => {
        console.error("❌ Error al cargar los sitios turísticos:", err);
        alert("Error al cargar sitios turísticos. Consulta la consola.");
      });
  </script>
{% endblock %}
